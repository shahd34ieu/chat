# -*- coding: utf-8 -*-
"""Untitled1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/16lOvcmW-JivKaF1OeLkWufGPzu_xNF7A
"""

!pip install streamlit transformers langchain requests beautifulsoup4

from transformers import pipeline
import requests
from bs4 import BeautifulSoup

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
qa_model = pipeline("question-answering",
                    model="deepset/xlm-roberta-large-squad2",
                    tokenizer="deepset/xlm-roberta-large-squad2")

# Ø§Ù„Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ù…ÙˆÙ‚Ø¹ Drugs.com
def search_drugs_dot_com(query):
    url = f"https://www.drugs.com/search.php?searchterm={query}"
    headers = {"User-Agent": "Mozilla/5.0"}
    response = requests.get(url, headers=headers)
    soup = BeautifulSoup(response.content, "html.parser")
    results = soup.find_all("a", class_="ddc-media-title", limit=1)

    if results:
        drug_link = "https://www.drugs.com" + results[0]["href"]
        drug_page = requests.get(drug_link, headers=headers)
        drug_soup = BeautifulSoup(drug_page.content, "html.parser")
        paragraphs = drug_soup.find_all("p")
        context = " ".join(p.get_text() for p in paragraphs)
        return context
    return "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Drugs.com."

# Ø¯Ø§Ù„Ø© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©
def answer_question(question, context):
    result = qa_model(question=question, context=context)
    return result["answer"]

# ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø© ÙÙŠ ÙƒÙˆÙ„Ø§Ø¨
question = input("Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø·Ø¨ÙŠ (Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ): ")
context = search_drugs_dot_com(question)

if context.startswith("Ù„Ù… ÙŠØªÙ…"):
    print(context)
else:
    answer = answer_question(question, context)
    print(f"\nØ§Ù„Ø¥Ø¬Ø§Ø¨Ø©: {answer}")
# ÙˆØ§Ø¬Ù‡Ø© Streamlit
def main():
    st.set_page_config(page_title="Ø´Ø§Øª Ø¨ÙˆØª Ø·Ø¨ÙŠ", layout="centered")
    st.title("ğŸ’Š Ø´Ø§Øª Ø¨ÙˆØª Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© (Ø¹Ø±Ø¨ÙŠ + Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)")

    question = st.text_input("Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø·Ø¨ÙŠ (Ù…Ø«Ù„Ø§Ù‹: Ù…Ø§ Ù‡ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Ø§Ù„Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„ØŸ)")

    if question:
        with st.spinner("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø©..."):
            context = search_drugs_dot_com(question)
            if context.startswith("Ù„Ù… ÙŠØªÙ…"):
                st.warning(context)
            else:
                answer = answer_question(question, context)
                st.markdown(f"**Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:** {answer}")

if __name__ == "__main__":
    main()